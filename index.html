<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
<title>Mind Garden</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<style>
:root {
  --bg: #020617; --card: #0f172a; --muted: #94a3b8;
  --g1: #dcfce7; --g2: #86efac; --g3: #22c55e; --g4: #15803d;
  --today: #38bdf8;
}
* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
body { 
  margin: 0; font-family: -apple-system, system-ui, sans-serif; 
  background: var(--bg); color: #fff; overflow-x: hidden;
}

/* Main View Container */
#main-view {
  padding: env(safe-area-inset-top) 1rem env(safe-area-inset-bottom);
  max-width: 500px; margin: auto; transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
}

/* Box Breathing Overlay */
#breath-view {
  position: fixed; top: 0; left: -100%; width: 100%; height: 100%;
  background: radial-gradient(circle at center, #0f172a 0%, #020617 100%);
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  transition: left 0.4s cubic-bezier(0.16, 1, 0.3, 1);
  z-index: 100;
}
#breath-view.active { left: 0; }

.breath-circle {
  width: 200px; height: 200px; border: 4px solid var(--g3); border-radius: 50%;
  display: flex; align-items: center; justify-content: center; position: relative;
  transition: transform 4s linear;
}
.breath-label { font-size: 1.5rem; font-weight: bold; color: var(--g3); text-transform: uppercase; letter-spacing: 2px; }

/* Reused UI Styles */
.control-panel { background: #1e293b; border-radius: 20px; padding: 1.2rem; margin-bottom: 1rem; border: 1px solid #334155; margin-top: 1rem; }
.input-group { display: flex; gap: 8px; margin-top: 12px; }
.date-row { display: flex; align-items: center; justify-content: space-between; background: rgba(0,0,0,0.2); padding: 8px 12px; border-radius: 12px; }
input, textarea, button { background: #0f172a; border: 1px solid #334155; border-radius: 12px; color: #fff; padding: 12px; font-size: 16px; }
input[type="date"] { background: transparent; border: none; padding: 0; color-scheme: dark; }
.btn-primary { background: var(--g3); color: #020617; border: none; font-weight: 600; }
.btn-outline { background: transparent; border: 1px solid #334155; font-size: 0.8rem; padding: 10px; border-radius: 12px; color: #fff; }
.card { background: var(--card); border-radius: 20px; padding: 1.2rem; margin-bottom: 1rem; border: 1px solid #1f2937; }
.habit { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #1f2937; }
.check { width: 30px; height: 30px; border-radius: 50%; border: 2px solid var(--g3); display: flex; align-items: center; justify-content: center; }
.check.done { background: var(--g3); color: #020617; }
.heat { width: 14px; height: 14px; border-radius: 3px; margin: 2px; }
.garden { display: grid; grid-template-columns: repeat(auto-fill, minmax(50px, 1fr)); gap: 10px; }
.plant { height: 60px; background: rgba(255,255,255,0.05); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; }
.backup-zone { display: flex; gap: 8px; margin-top: 1rem; }

/* Animations for Breathing */
@keyframes inhale { from { transform: scale(0.6); } to { transform: scale(1.2); } }
@keyframes exhale { from { transform: scale(1.2); } to { transform: scale(0.6); } }
</style>
</head>
<body>

<div id="breath-view">
    <p style="color: var(--muted); margin-bottom: 2rem;">‚Üê Swipe Left to Garden</p>
    <div class="breath-circle" id="circle">
        <span class="breath-label" id="label">Inhale</span>
    </div>
    <p style="margin-top: 2rem; color: var(--muted); text-align: center; padding: 0 2rem;">Focus on the circle. 4-4-4-4 rhythm.</p>
</div>

<main id="main-view">
  <div class="control-panel">
    <div class="date-row">
      <span style="font-size: 0.8rem; color: var(--muted)">Log for:</span>
      <input type="date" id="datePicker">
    </div>
    <p style="font-size: 0.7rem; color: var(--muted); margin-top: 10px; text-align: center;">Swipe Right for Box Breathing üßò</p>
  </div>

  <div class="card">
    <strong>Garden</strong>
    <div id="garden" class="garden" style="margin-top: 10px;"></div>
  </div>

  <div class="card" id="habitList"></div>

  <div class="card">
    <div class="input-group">
      <input id="habitInput" placeholder="Add new habit...">
      <button class="btn-primary" onclick="addHabit()">Add</button>
    </div>
  </div>

  <div class="card">
    <strong>Journal</strong>
    <textarea id="journal" style="width:100%; margin-top:10px; height:80px" placeholder="Write here..."></textarea>
    <button style="width:100%; margin-top:10px" onclick="saveJournal()">Save Entry</button>
  </div>

  <div class="card">
    <strong>Activity</strong>
    <div id="monthly" style="overflow-x: auto; margin-top: 10px;"></div>
    <div class="backup-zone">
      <button class="btn-outline" style="flex:1" onclick="exportCSV()">üì• Export</button>
      <button class="btn-outline" style="flex:1" onclick="document.getElementById('fileInput').click()">üì§ Import</button>
    </div>
    <input type="file" id="fileInput" style="display:none" onchange="importCSV(event)" accept=".csv">
  </div>
</main>

<script>
// --- CORE LOGIC ---
const dp = document.getElementById('datePicker');
dp.value = new Date().toISOString().slice(0, 10);
const load = () => JSON.parse(localStorage.getItem('habits') || '[]');
const save = h => localStorage.setItem('habits', JSON.stringify(h));

// --- SWIPE LOGIC ---
let touchStartX = 0;
document.addEventListener('touchstart', e => touchStartX = e.changedTouches[0].screenX);
document.addEventListener('touchend', e => {
    let touchEndX = e.changedTouches[0].screenX;
    let diff = touchEndX - touchStartX;
    if (diff > 100) toggleView(true); // Right swipe -> Breathing
    if (diff < -100) toggleView(false); // Left swipe -> Garden
});

function toggleView(showBreath) {
    const main = document.getElementById('main-view');
    const breath = document.getElementById('breath-view');
    if (showBreath) {
        breath.classList.add('active');
        main.style.transform = "translateX(100%)";
        startBreathing();
    } else {
        breath.classList.remove('active');
        main.style.transform = "translateX(0)";
        stopBreathing();
    }
}

// --- BOX BREATHING ANIMATION ---
let breathInterval;
function startBreathing() {
    const label = document.getElementById('label');
    const circle = document.getElementById('circle');
    const steps = [
        { text: 'Inhale', anim: 'inhale' },
        { text: 'Hold', anim: 'none' },
        { text: 'Exhale', anim: 'exhale' },
        { text: 'Hold', anim: 'none' }
    ];
    let step = 0;
    const run = () => {
        const current = steps[step];
        label.innerText = current.text;
        circle.style.animation = current.anim === 'none' ? 'none' : `${current.anim} 4s forwards linear`;
        step = (step + 1) % 4;
    };
    run();
    breathInterval = setInterval(run, 4000);
}
function stopBreathing() { clearInterval(breathInterval); }

// --- HABIT APP LOGIC ---
function addHabit() {
  const i = document.getElementById('habitInput');
  if (!i.value.trim()) return;
  const h = load(); h.push({ name: i.value, done: [] });
  save(h); i.value = ''; render();
}
function toggle(i) {
  const h = load(); const d = dp.value;
  const idx = h[i].done.indexOf(d);
  idx >= 0 ? h[i].done.splice(idx, 1) : h[i].done.push(d);
  save(h); render();
}
function render() {
  const h = load(); const d = dp.value;
  const hl = document.getElementById('habitList'); hl.innerHTML = '';
  document.getElementById('journal').value = localStorage.getItem('j-' + d) || '';
  if(h.length === 0) hl.innerHTML = '<div style="color:var(--muted); text-align:center; padding:10px;">No habits yet.</div>';
  h.forEach((x, i) => {
    const row = document.createElement('div'); row.className = 'habit';
    row.innerHTML = `<div>${x.name}</div><div class="check ${x.done.includes(d)?'done':''}" onclick="toggle(${i})">${x.done.includes(d)?'‚úì':''}</div>`;
    hl.appendChild(row);
  });
  renderMonth(); renderGarden();
}
function renderMonth() {
  const h = load(); const c = document.getElementById('monthly');
  const sel = new Date(dp.value + 'T00:00:00');
  const y = sel.getFullYear(), m = sel.getMonth();
  const days = new Date(y, m + 1, 0).getDate();
  let t = '<table style="border-collapse: collapse;">';
  h.forEach(x => {
    t += '<tr>';
    for(let d=1; d<=days; d++) {
      const k = `${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
      t += `<td><div class="heat" style="background:${x.done.includes(k)?'var(--g3)':'#1e293b'}"></div></td>`;
    }
    t += '</tr>';
  });
  c.innerHTML = t + '</table>';
}
function renderGarden() {
  const g = document.getElementById('garden'); g.innerHTML = '';
  load().forEach(x => {
    const div = document.createElement('div'); div.className = 'plant';
    div.innerHTML = x.done.length > 10 ? 'üå∏' : x.done.length > 0 ? 'üå±' : 'üï≥Ô∏è';
    g.appendChild(div);
  });
}
function saveJournal() { localStorage.setItem('j-'+dp.value, document.getElementById('journal').value); alert("Saved"); }
function exportCSV() {
  let csv = "Type,Name,Date,Content\n";
  load().forEach(h => h.done.forEach(d => csv += `Habit,"${h.name}",${d},DONE\n`));
  Object.keys(localStorage).filter(k=>k.startsWith('j-')).forEach(k=>csv+=`Journal,,${k.replace('j-','')},"${localStorage.getItem(k)}"\n`);
  const a = document.createElement('a'); a.href = URL.createObjectURL(new Blob([csv],{type:'text/csv'})); a.download='backup.csv'; a.click();
}
function importCSV(event) {
  const reader = new FileReader();
  reader.onload = (e) => {
    const habits = [];
    e.target.result.split('\n').slice(1).forEach(row => {
      const p = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
      if (p.length < 3) return;
      if (p[0].trim()==='Habit') {
        let h = habits.find(x=>x.name===p[1].replace(/"/g,''));
        if (!h) { h={name:p[1].replace(/"/g,''),done:[]}; habits.push(h); }
        h.done.push(p[2].trim());
      } else { localStorage.setItem('j-'+p[2].trim(), p[3].replace(/"/g,'')); }
    });
    save(habits); render();
  };
  reader.readAsText(event.target.files[0]);
}
dp.onchange = render;
render();
</script>
</body>
</html>
