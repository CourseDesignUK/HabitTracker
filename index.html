<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1, user-scalable=0" />
  <title>Habit Tracker Pro</title>

  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  
  <style>
    :root {
      --bg: #020617;
      --card: rgba(30, 41, 59, 0.5);
      --accent: #22c55e;
      --muted: #94a3b8;
      --danger: #ef4444;
      --text: #ffffff;
      --glass-border: rgba(255, 255, 255, 0.1);
    }

    [data-theme="light"] {
      --bg: #f8fafc;
      --card: rgba(255, 255, 255, 0.8);
      --accent: #16a34a;
      --muted: #64748b;
      --danger: #dc2626;
      --text: #0f172a;
      --glass-border: rgba(0, 0, 0, 0.1);
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; transition: background 0.3s, color 0.3s; }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      padding: env(safe-area-inset-top) 1rem env(safe-area-inset-bottom);
    }

    header { padding: 2rem 1rem 1rem; text-align: center; }
    
    .progress-container {
      width: 100%; background: rgba(128,128,128,0.2);
      height: 8px; border-radius: 10px; margin: 1.5rem 0; overflow: hidden;
    }
    #progressBar {
      height: 100%; background: var(--accent); width: 0%;
      transition: width 0.5s ease; box-shadow: 0 0 10px var(--accent);
    }

    main { max-width: 480px; margin: auto; }

    .card {
      background: var(--card); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
      border: 1px solid var(--glass-border); border-radius: 24px;
      padding: 1.2rem; margin-bottom: 1rem;
    }

    .tab-container { display: flex; gap: 10px; margin-bottom: 15px; }
    .tab-btn {
      flex: 1; padding: 12px; border-radius: 14px; border: 1px solid var(--glass-border);
      background: rgba(128,128,128,0.1); color: var(--text); cursor: pointer; font-weight: 600;
    }
    .tab-btn.active { background: var(--accent); color: white; border: none; }

    .history-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; margin-top: 10px; }
    .day-cell {
      aspect-ratio: 1; border-radius: 8px; background: rgba(128,128,128,0.1);
      display: flex; align-items: center; justify-content: center; font-size: 0.75rem;
    }
    .day-cell.complete { background: var(--accent); color: white; font-weight: bold; }
    .day-cell.partial { background: var(--accent); opacity: 0.4; color: var(--text); }

    .add-habit { display: flex; gap: 0.8rem; }
    .add-habit input {
      flex: 1; background: rgba(128,128,128,0.1); border: 1px solid var(--glass-border);
      border-radius: 14px; padding: 0.8rem; color: var(--text); outline: none;
    }
    .add-habit button {
      background: var(--accent); border: none; border-radius: 14px; padding: 0 1.2rem; color: white; font-weight: bold;
    }

    .habit { display: flex; align-items: center; justify-content: space-between; padding: 1rem 0; border-bottom: 1px solid var(--glass-border); }
    .streak-badge { font-size: 0.75rem; color: #d97706; font-weight: 600; }
    .check { width: 34px; height: 34px; border-radius: 12px; border: 2px solid var(--accent); display: flex; align-items: center; justify-content: center; cursor: pointer; }
    .check.done { background: var(--accent); color: white; }
    
    .settings-bar { display: flex; justify-content: space-between; margin-top: 20px; }
    .icon-btn { background: none; border: none; color: var(--muted); font-size: 0.9rem; cursor: pointer; text-decoration: underline; }

    .hidden { display: none; }
  </style>
</head>
<body data-theme="dark">

<header>
  <h1 id="viewTitle">Daily Habits</h1>
  <div class="progress-container"><div id="progressBar"></div></div>
</header>

<main>
  <div class="tab-container">
    <button class="tab-btn active" onclick="switchTab('daily')">Daily</button>
    <button class="tab-btn" onclick="switchTab('history')">History</button>
  </div>

  <div id="dailyView">
    <div class="card">
      <div class="add-habit">
        <input id="habitInput" placeholder="Drink water..." autocomplete="off" />
        <button onclick="addHabit()">+</button>
      </div>
    </div>
    <div class="card" id="habitList"></div>
  </div>

  <div id="historyView" class="hidden">
    <div class="card">
      <div id="historyGrid" class="history-grid"></div>
    </div>
  </div>

  <div class="settings-bar">
    <button class="icon-btn" onclick="toggleTheme()">ðŸŒ“ Switch Theme</button>
    <button class="icon-btn" onclick="exportData()">ðŸ“¥ Export CSV</button>
  </div>
</main>

<script>
  const todayKey = new Date().toISOString().slice(0, 10);
  
  function loadHabits() { return JSON.parse(localStorage.getItem('habits') || '[]'); }
  function saveHabits(habits) { localStorage.setItem('habits', JSON.stringify(habits)); render(); }

  function switchTab(tab) {
    document.getElementById('dailyView').classList.toggle('hidden', tab !== 'daily');
    document.getElementById('historyView').classList.toggle('hidden', tab !== 'history');
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.toggle('active', b.innerText.toLowerCase().includes(tab)));
    document.getElementById('viewTitle').innerText = tab === 'daily' ? 'Daily Habits' : 'Consistency Map';
    if(tab === 'history') renderHistory();
  }

  function toggleTheme() {
    const body = document.body;
    const newTheme = body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
    body.setAttribute('data-theme', newTheme);
    localStorage.setItem('theme', newTheme);
  }

  function exportData() {
    const habits = loadHabits();
    let csv = "Habit,DateCompleted\n";
    habits.forEach(h => {
      h.doneDates.forEach(date => {
        csv += `${h.name},${date}\n`;
      });
    });
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.setAttribute('href', url);
    a.setAttribute('download', 'habit_history.csv');
    a.click();
  }

  function getStreak(dates) {
    let s = 0; let d = new Date();
    while(true) {
      let k = d.toISOString().slice(0, 10);
      if(dates.includes(k)) { s++; d.setDate(d.getDate()-1); }
      else { if(s===0 && k===todayKey) { d.setDate(d.getDate()-1); continue; } break; }
    }
    return s;
  }

  function render() {
    const list = document.getElementById('habitList');
    const habits = loadHabits();
    list.innerHTML = habits.length ? '' : '<p style="text-align:center;color:var(--muted)">No habits tracked yet.</p>';
    
    let doneCount = 0;
    habits.forEach((h, i) => {
      const isDone = h.doneDates.includes(todayKey);
      if(isDone) doneCount++;
      const row = document.createElement('div');
      row.className = 'habit';
      row.innerHTML = `
        <div><div style="font-weight:600">${h.name}</div><div class="streak-badge">ðŸ”¥ ${getStreak(h.doneDates)} Day Streak</div></div>
        <div style="display:flex;gap:15px;align-items:center">
          <div class="check ${isDone?'done':''}" onclick="toggleDone(${i})">${isDone?'âœ“':''}</div>
          <button style="background:none;border:none;color:var(--danger);font-size:1.2rem;" onclick="deleteHabit(${i})">Ã—</button>
        </div>`;
      list.appendChild(row);
    });
    document.getElementById('progressBar').style.width = habits.length ? (doneCount/habits.length)*100+'%' : '0%';
  }

  function renderHistory() {
    const grid = document.getElementById('historyGrid');
    grid.innerHTML = '';
    const habits = loadHabits();
    const now = new Date();
    const days = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();

    for (let i = 1; i <= days; i++) {
      const dateKey = new Date(now.getFullYear(), now.getMonth(), i).toISOString().slice(0, 10);
      let count = 0;
      habits.forEach(h => { if(h.doneDates.includes(dateKey)) count++; });
      const cell = document.createElement('div');
      cell.className = 'day-cell';
      if(habits.length > 0 && count === habits.length) cell.classList.add('complete');
      else if(count > 0) cell.classList.add('partial');
      cell.innerText = i;
      grid.appendChild(cell);
    }
  }

  function addHabit() {
    const input = document.getElementById('habitInput');
    if(!input.value.trim()) return;
    const h = loadHabits(); h.push({name: input.value.trim(), doneDates: []});
    saveHabits(h); input.value = '';
  }

  function toggleDone(i) {
    const h = loadHabits();
    const d = h[i].doneDates;
    const idx = d.indexOf(todayKey);
    idx >= 0 ? d.splice(idx, 1) : d.push(todayKey);
    saveHabits(h);
  }

  function deleteHabit(i) { if(confirm('Delete?')) { const h = loadHabits(); h.splice(i,1); saveHabits(h); } }

  // Load saved theme
  const savedTheme = localStorage.getItem('theme') || 'dark';
  document.body.setAttribute('data-theme', savedTheme);

  render();
</script>
</body>
</html>
