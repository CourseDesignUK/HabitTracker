<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
<title>Mind Garden</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<style>
:root {
  --bg: #020617; --card: #0f172a; --muted: #94a3b8;
  --g3: #22c55e; --red: #ef4444; --accent: #38bdf8;
}
* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
body { 
  margin: 0; font-family: -apple-system, system-ui, sans-serif; 
  background: var(--bg); color: #fff; overflow: hidden;
}

/* Screen Wrapper */
#screen-container {
    display: flex; width: 300%; height: 100vh;
    transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    transform: translateX(-33.33%); /* Start at center (Garden) */
}

.view { width: 33.33%; height: 100vh; overflow-y: auto; padding: 1rem; position: relative; }

/* Media Player View (Left) */
#media-view { background: linear-gradient(180deg, #0f172a 0%, #020617 100%); display: flex; flex-direction: column; align-items: center; justify-content: center; }
.track-card { background: rgba(255,255,255,0.05); width: 100%; max-width: 350px; border-radius: 20px; padding: 1.5rem; margin: 10px 0; border: 1px solid rgba(255,255,255,0.1); cursor: pointer; transition: background 0.2s; }
.track-card.playing { border-color: var(--accent); background: rgba(56, 189, 248, 0.1); }
.track-card h3 { margin: 0; font-size: 1.1rem; }
.track-card p { margin: 5px 0 0; font-size: 0.8rem; color: var(--muted); }

/* Box Breathing (Right) */
#breath-view { background: radial-gradient(circle at center, #0f172a 0%, #020617 100%); display: flex; flex-direction: column; align-items: center; justify-content: center; }
.breath-circle {
  width: 180px; height: 180px; border: 4px solid var(--g3); border-radius: 50%;
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  transition: transform 4s linear; box-shadow: 0 0 30px rgba(34, 197, 94, 0.2);
}

/* Garden (Center) */
.card { background: var(--card); border-radius: 20px; padding: 1.2rem; margin-bottom: 1rem; border: 1px solid #1f2937; }
.habit { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #1f2937; }
.check { width: 32px; height: 32px; border-radius: 50%; border: 2px solid var(--g3); display: flex; align-items: center; justify-content: center; }
.check.done { background: var(--g3); color: #020617; }
.garden { display: grid; grid-template-columns: repeat(auto-fill, minmax(50px, 1fr)); gap: 10px; }
.plant { height: 60px; background: rgba(255,255,255,0.05); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; }
input, textarea, button { background: #0f172a; border: 1px solid #334155; border-radius: 12px; color: #fff; padding: 12px; }
.btn-primary { background: var(--g3); color: #020617; border: none; font-weight: 700; width: 80px; }
</style>
</head>
<body>

<div id="screen-container">
    <div class="view" id="media-view">
        <h2 style="color: var(--accent)">Nature Sounds</h2>
        <p style="color: var(--muted); margin-bottom: 2rem;">Swipe Right for Garden</p>
        
        <div class="track-card" onclick="playTrack('storm', this)">
            <h3>‚õàÔ∏è Tropical Storm</h3>
            <p>Thunder and heavy tropical rain</p>
        </div>
        <div class="track-card" onclick="playTrack('waves', this)">
            <h3>üåä Ocean Waves</h3>
            <p>Steady rhythm of the Pacific</p>
        </div>
        <div class="track-card" onclick="playTrack('forest', this)">
            <h3>ü¶ú Rainforest</h3>
            <p>Birds and gentle jungle canopy</p>
        </div>

        <button onclick="stopAudio()" style="margin-top: 2rem; width: 200px; background: var(--red); border:none;">Stop Audio</button>
    </div>

    <div class="view">
        <div class="card" style="margin-top: 1rem; background: #1e293b;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <span style="font-size: 0.8rem; color: var(--muted)">‚Üê Sounds | Garden | Zen ‚Üí</span>
                <input type="date" id="datePicker" style="border:none; padding:0; background:none; font-size: 0.8rem;">
            </div>
        </div>
        <div class="card"><strong>Garden</strong><div id="garden" class="garden" style="margin-top: 10px;"></div></div>
        <div class="card" id="habitList"></div>
        <div class="card"><div style="display:flex; gap:8px"><input id="habitInput" placeholder="New habit..." style="flex:1"><button class="btn-primary" onclick="addHabit()">Add</button></div></div>
        <div class="card"><strong>Journal</strong><textarea id="journal" style="width:100%; margin-top:10px; height:80px" placeholder="Thoughts..."></textarea><button style="width:100%; margin-top:10px" onclick="saveJournal()">Save Entry</button></div>
        <div class="card"><strong>Backup</strong><div id="monthly" style="overflow-x: auto; margin: 10px 0;"></div><div style="display:flex; gap:8px"><button style="flex:1" onclick="exportToICloud()">üì• iCloud</button><button style="flex:1" onclick="document.getElementById('fileInput').click()">üì§ Import</button></div><input type="file" id="fileInput" style="display:none" onchange="importCSV(event)" accept=".csv"></div>
    </div>

    <div class="view" id="breath-view">
        <p style="color: var(--muted); margin-bottom: 3rem;">‚Üê Swipe Left to Garden</p>
        <div class="breath-circle" id="circle">
            <span style="font-size:1.2rem; color:var(--g3); text-transform:uppercase;" id="label">Prepare</span>
            <div style="font-size:2.5rem; font-weight:800;" id="count">...</div>
        </div>
    </div>
</div>

<audio id="naturePlayer" loop></audio>

<script>
const dp = document.getElementById('datePicker');
dp.value = new Date().toISOString().slice(0, 10);
const load = () => JSON.parse(localStorage.getItem('habits') || '[]');
const save = h => localStorage.setItem('habits', JSON.stringify(h));

// --- MEDIA PLAYER ---
const player = document.getElementById('naturePlayer');
const tracks = {
    storm: 'https://cdn.pixabay.com/download/audio/2022/03/10/audio_f6707a0499.mp3?filename=thunder-nature-sounds-8422.mp3',
    waves: 'https://cdn.pixabay.com/download/audio/2022/01/18/audio_2491a56653.mp3?filename=ocean-waves-112906.mp3',
    forest: 'https://cdn.pixabay.com/download/audio/2021/11/25/audio_254054a737.mp3?filename=tropical-forest-with-exotic-birds-sounds-8356.mp3'
};

function playTrack(type, el) {
    document.querySelectorAll('.track-card').forEach(c => c.classList.remove('playing'));
    el.classList.add('playing');
    player.src = tracks[type];
    player.play();
}

function stopAudio() {
    player.pause();
    document.querySelectorAll('.track-card').forEach(c => c.classList.remove('playing'));
}

// --- NAVIGATION ---
let startX = 0, currentPane = 1; // 0=Media, 1=Garden, 2=Breath
document.addEventListener('touchstart', e => startX = e.changedTouches[0].screenX);
document.addEventListener('touchend', e => {
    let diff = e.changedTouches[0].screenX - startX;
    if (Math.abs(diff) > 80) {
        if (diff > 0 && currentPane > 0) currentPane--;
        else if (diff < 0 && currentPane < 2) currentPane++;
        updatePane();
    }
});

function updatePane() {
    document.getElementById('screen-container').style.transform = `translateX(-${currentPane * 33.33}%)`;
    if (currentPane === 2) startBreathing(); else stopBreathing();
}

// --- BREATHING & HABITS ---
let bT, cT;
function startBreathing() {
    const l=document.getElementById('label'), c=document.getElementById('circle'), co=document.getElementById('count');
    const steps=[{t:'Inhale',s:'scale(1.3)'},{t:'Hold',s:'scale(1.3)'},{t:'Exhale',s:'scale(0.7)'},{t:'Hold',s:'scale(0.7)'}];
    let s=0, sec=4;
    const up=()=>{ l.innerText=steps[s].t; c.style.transform=steps[s].s; if(navigator.vibrate)navigator.vibrate(100); };
    up();
    bT=setInterval(()=>{s=(s+1)%4; sec=4; up();}, 4000);
    cT=setInterval(()=>{sec--; if(sec<=0)sec=4; co.innerText=sec; if(navigator.vibrate)navigator.vibrate(10);}, 1000);
}
function stopBreathing(){ clearInterval(bT); clearInterval(cT); }

function addHabit() {
    const i=document.getElementById('habitInput'); if(!i.value.trim())return;
    const h=load(); h.push({name:i.value, done:[]}); save(h); i.value=''; render();
}
function toggle(idx) {
    const h=load(), d=dp.value, i=h[idx].done.indexOf(d);
    i>=0 ? h[idx].done.splice(i,1) : h[idx].done.push(d); save(h); render();
}
function render() {
    const h=load(), d=dp.value, hl=document.getElementById('habitList'); hl.innerHTML='';
    document.getElementById('journal').value = localStorage.getItem('j-'+d)||'';
    h.forEach((x,i)=>{
        const row=document.createElement('div'); row.className='habit';
        row.innerHTML=`<div>${x.name}</div><div class="check ${x.done.includes(d)?'done':''}" onclick="toggle(${i})">${x.done.includes(d)?'‚úì':''}</div>`;
        hl.appendChild(row);
    });
    renderGarden();
}
function renderGarden(){
    const g=document.getElementById('garden'); g.innerHTML='';
    load().forEach(x=>{ const d=document.createElement('div'); d.className='plant'; d.innerHTML=x.done.length>10?'üå∏':x.done.length>0?'üå±':'üï≥Ô∏è'; g.appendChild(d); });
}
async function exportToICloud() {
    let csv="Type,Name,Date,Content\n";
    load().forEach(h=>h.done.forEach(d=>csv+=`Habit,"${h.name}",${d},DONE\n`));
    const f=new File([new Blob([csv],{type:'text/csv'})], `MindGarden_${dp.value}.csv`,{type:'text/csv'});
    if(navigator.share) navigator.share({files:[f]});
}
function saveJournal(){ localStorage.setItem('j-'+dp.value, document.getElementById('journal').value); alert("Saved"); }

dp.onchange = render;
render();
</script>
</body>
</html>
