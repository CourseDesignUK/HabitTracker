<!DOCTYPE html> 
<html lang="en"> 
<head> 
    <meta charset="UTF-8" /> 
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" /> 
    <title>Mind Garden</title> 
    
    <meta name="apple-mobile-web-app-capable" content="yes"> 
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"> 

    <style> 
        :root { 
            --bg: #020617; 
            --card: rgba(30, 41, 59, 0.5); 
            --muted: #94a3b8; 
            --g-pale: #4ade80; 
            --g-dark: #166534; 
            --accent: #38bdf8; 
            --border: rgba(255, 255, 255, 0.1); 
            --soil-bottom: rgba(45, 26, 12, 0.4); 
            --coffee: #92400e;
            --wine: #6366f1;
            --red: #ef4444;
        } 

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; } 
        html { background: var(--bg); height: 100%; width: 100%; overflow: hidden; } 

        body {  
            margin: 0; font-family: -apple-system, system-ui, sans-serif; 
            background: radial-gradient(circle at top right, #0f172a, #020617); 
            color: #fff; overflow: hidden; overscroll-behavior: none;  
            height: 100%; width: 100%; 
        } 

        #screen-container {  
            display: flex; width: 400%; height: 100%;  
            will-change: transform; transform: translateX(-25%); 
            transition: transform 0.5s cubic-bezier(0.16, 1, 0.3, 1); 
        } 

        .view {  
            width: 25%; height: 100%; overflow-y: auto; padding: 1.5rem;  
            padding-top: calc(env(safe-area-inset-top) + 10px);  
            padding-bottom: calc(env(safe-area-inset-bottom) + 100px); 
            position: relative; flex-shrink: 0; 
            -webkit-overflow-scrolling: touch;
        } 

        .nav-dots { 
            position: fixed; bottom: calc(env(safe-area-inset-bottom) + 20px); 
            left: 50%; transform: translateX(-50%); display: flex; gap: 12px; z-index: 100; 
        } 
        .dot { width: 8px; height: 8px; border-radius: 50%; background: rgba(255, 255, 255, 0.2); transition: 0.3s; } 
        .dot.active { background: var(--accent); transform: scale(1.3); box-shadow: 0 0 10px var(--accent); } 

        .card {  
            background: var(--card); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); 
            border-radius: 24px; padding: 1.2rem; margin-bottom: 1rem; border: 1px solid var(--border); 
        } 

        /* Garden */
        .garden {  
            display: flex; flex-wrap: wrap; justify-content: center; align-items: flex-end;  
            gap: 2px; padding: 40px 15px 15px 15px; 
            background: linear-gradient(to bottom, transparent 50%, var(--soil-bottom) 100%); 
            border-radius: 30px; min-height: 160px; transition: all 1s ease; position: relative; 
        } 
        .plant { display: inline-block; animation: sway 5s ease-in-out infinite alternate; filter: drop-shadow(0 4px 4px rgba(0,0,0,0.2)); z-index: 2; transform-origin: bottom center; } 
        @keyframes sway { 0% { transform: rotate(-2deg); } 100% { transform: rotate(3deg); } } 

        /* Graphing */
        .graph-container { width: 100%; height: 120px; margin-top: 15px; overflow: visible; }
        .graph-line { fill: none; stroke-width: 3; stroke-linecap: round; stroke-linejoin: round; }
        .graph-area { opacity: 0.15; }

        /* Helpers */
        .pomo-time { font-size: 3.5rem; font-weight: 800; color: var(--accent); text-align: center; } 
        .habit { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.05); } 
        .check { width: 36px; height: 36px; border-radius: 12px; border: 2px solid var(--g-pale); display: flex; align-items: center; justify-content: center; cursor: pointer; } 
        .check.done { background: var(--g-pale); color: #020617; } 
        input, button { background: rgba(15, 23, 42, 0.8); border: 1px solid var(--border); border-radius: 14px; color: #fff; padding: 12px; font-size: 16px; outline: none; } 
        .btn-primary { background: var(--g-pale); color: #020617; border: none; font-weight: 700; width: 100%; cursor: pointer;} 
        .track-card { background: var(--card); border-radius: 16px; padding: 1rem; margin: 8px 0; border: 1px solid var(--border); display: flex; align-items: center; gap: 15px; } 
        .track-card.playing { border-color: var(--accent); background: rgba(56, 189, 248, 0.15); } 
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; } 
        .cal-day { aspect-ratio: 1; border-radius: 6px; background: rgba(255,255,255,0.05); font-size: 0.7rem; display: flex; align-items: center; justify-content: center; color: rgba(255,255,255,0.3); } 
        .cal-day.active { border: 2px solid var(--accent); color: #fff; } 
    </style> 
</head> 
<body> 

<div class="nav-dots"> 
    <div class="dot" id="dot0"></div> 
    <div class="dot active" id="dot1"></div> 
    <div class="dot" id="dot2"></div> 
    <div class="dot" id="dot3"></div> 
</div> 

<div id="screen-container"> 
    <div class="view"> 
        <h2 style="color: var(--accent); margin-top:0">Focus Zone</h2> 
        <div class="card" style="text-align:center"> 
            <div id="pomoPhase" style="font-size:0.7rem; color:var(--muted); text-transform:uppercase">Ready</div> 
            <div class="pomo-time" id="pomoDisplay">48:00</div> 
            <button id="pomoBtn" onclick="togglePomo()" class="btn-primary" style="background: var(--accent); margin-top:10px">Start Session</button> 
        </div> 
        <div class="track-card" onclick="playTrack('storm', this)"><span>‚õàÔ∏è</span><strong>Tropical Storm</strong></div> 
        <div class="track-card" onclick="playTrack('waves', this)"><span>üåä</span><strong>Ocean Waves</strong></div> 
        <div class="track-card" onclick="playTrack('forest', this)"><span>üå≤</span><strong>Deep Forest</strong></div> 
        <div class="track-card" onclick="playTrack('birds', this)"><span>üê¶</span><strong>Birdsong</strong></div> 
        <button onclick="stopAudio()" style="background:var(--red); width:100%; border:none; font-weight:bold; margin-top:10px">Mute Sounds</button> 
    </div> 

    <div class="view"> 
        <div class="card"> 
            <strong id="gardenTitle">Your Garden</strong> 
            <div id="garden" class="garden"></div> 
        </div> 
        <div id="habitList" class="card"></div> 
        <div class="card"> 
            <div style="display:flex; justify-content:space-between; margin-bottom:10px"> 
                <span id="monthLabel" style="font-size:0.8rem; font-weight:bold">Heatmap</span> 
                <input type="date" id="datePicker" style="padding:0; background:none; border:none; color:var(--accent); width:auto"> 
            </div> 
            <div id="calendar" class="calendar-grid"></div> 
        </div> 
        <div class="card"> 
            <input id="habitInput" placeholder="New habit..." style="width:100%"> 
            <button class="btn-primary" onclick="addHabit()" style="margin-top:10px">Plant Habit</button> 
        </div> 
    </div> 

    <div class="view">
        <h2 style="margin-top:0">Intake Trends</h2>
        <div class="card">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px">
                <div><strong>Caffeine</strong><br><small id="caffeineStatus">0 cups</small></div>
                <div style="display:flex; gap:10px; align-items:center">
                    <button onclick="addCaffeine(-1)">‚àí</button>
                    <span id="caffeineCount" style="font-weight:bold">0</span>
                    <button onclick="addCaffeine(1)" style="background:var(--coffee); border:none">+</button>
                </div>
            </div>
            <div style="display:flex; justify-content:space-between; align-items:center">
                <div><strong>Alcohol</strong><br><small id="alcoholStatus">0 units</small></div>
                <div style="display:flex; gap:10px; align-items:center">
                    <button onclick="addAlcohol(-1)">‚àí</button>
                    <span id="alcoholCount" style="font-weight:bold">0</span>
                    <button onclick="addAlcohol(1)" style="background:var(--wine); border:none">+</button>
                </div>
            </div>
        </div>

        <div class="card">
            <small style="text-transform:uppercase; letter-spacing:1px; color:var(--muted)">Rolling 30-Day Activity</small>
            <div class="graph-container" id="graphContainer">
                <svg id="trendGraph" width="100%" height="100%" preserveAspectRatio="none" viewBox="0 0 300 100">
                    <path id="caffeineArea" class="graph-area" fill="var(--coffee)"></path>
                    <path id="caffeineLine" class="graph-line" stroke="var(--coffee)"></path>
                    <path id="alcoholArea" class="graph-area" fill="var(--wine)"></path>
                    <path id="alcoholLine" class="graph-line" stroke="var(--wine)"></path>
                </svg>
            </div>
            <div style="display:flex; justify-content:space-between; font-size:0.6rem; color:var(--muted); margin-top:5px">
                <span>30 Days Ago</span>
                <span>Today</span>
            </div>
        </div>

        <div style="display:flex; gap:10px; margin-top:10px"> 
            <button onclick="exportData()" style="flex:1; font-size:0.7rem">üì• Backup</button> 
            <button onclick="document.getElementById('importFile').click()" style="flex:1; font-size:0.7rem">üì§ Restore</button> 
            <input type="file" id="importFile" style="display:none" onchange="importData(event)"> 
        </div>
    </div>

    <div class="view" style="display:flex; flex-direction:column; align-items:center; justify-content:center;"> 
        <div class="card" style="width:100%; text-align:center"> 
            <div id="dailyQuote" style="font-style:italic; font-size:0.9rem; margin-bottom:8px">"Don't explain your philosophy. Embody it."</div> 
            <div id="quoteAuthor" style="font-size:0.75rem; color:var(--muted); font-weight:bold">‚Äî Epictetus</div> 
        </div> 
        <div class="card" id="circle" onclick="toggleBreathing()" style="width:180px; height:180px; display:flex; flex-direction:column; align-items:center; justify-content:center; border:4px solid var(--g-pale); border-radius:32px; transition:4s linear"> 
            <span id="label" style="font-size:0.6rem; color:var(--g-pale)">TAP TO BREATHE</span> 
            <div style="font-size:3rem; font-weight:800" id="count">...</div> 
        </div> 
    </div> 
</div> 

<audio id="naturePlayer" loop></audio> 

<script> 
/* STATE */
let currentPane = 1;
const dp = document.getElementById('datePicker'); 
dp.value = new Date().toISOString().slice(0, 10); 
let caffeineData = JSON.parse(localStorage.getItem('caffeine') || '{}'); 
let alcoholData = JSON.parse(localStorage.getItem('alcohol') || '{}');

/* 30-DAY GRAPH LOGIC */
function renderGraph() {
    const dates = [];
    for(let i=29; i>=0; i--) {
        const d = new Date();
        d.setDate(d.getDate() - i);
        dates.push(d.toISOString().slice(0,10));
    }

    const generatePath = (data) => {
        const points = dates.map((date, x) => {
            const val = data[date] || 0;
            const y = 100 - (Math.min(val, 10) * 10); // Scale 0-10 to 0-100%
            return `${x * (300/29)},${y}`;
        });
        return points;
    };

    const cPts = generatePath(caffeineData);
    const aPts = generatePath(alcoholData);

    document.getElementById('caffeineLine').setAttribute('d', `M ${cPts.join(' L ')}`);
    document.getElementById('caffeineArea').setAttribute('d', `M 0,100 L ${cPts.join(' L ')} L 300,100 Z`);
    
    document.getElementById('alcoholLine').setAttribute('d', `M ${aPts.join(' L ')}`);
    document.getElementById('alcoholArea').setAttribute('d', `M 0,100 L ${aPts.join(' L ')} L 300,100 Z`);
}

/* POMO */
let pomoTime = 2880, pomoInterval = null, isPomoRunning = false, isWorkPhase = true; 
function togglePomo() { 
    const btn = document.getElementById('pomoBtn'); 
    if (isPomoRunning) { clearInterval(pomoInterval); isPomoRunning = false; btn.innerText = "Resume"; } 
    else { 
        isPomoRunning = true; btn.innerText = "Pause"; 
        pomoInterval = setInterval(() => { 
            pomoTime--; 
            let m = Math.floor(pomoTime/60), s = pomoTime%60; 
            document.getElementById('pomoDisplay').innerText = `${m}:${s<10?'0':''}${s}`; 
            if (pomoTime <= 0) { 
                isWorkPhase = !isWorkPhase; pomoTime = isWorkPhase ? 2880 : 720; 
                document.getElementById('pomoPhase').innerText = isWorkPhase ? "Focus" : "Rest";
                alert(isWorkPhase ? "Focus!" : "Break!"); 
            } 
        }, 1000); 
    } 
} 

/* DATA TRACKING */
function addCaffeine(v) { 
    const d = dp.value; caffeineData[d] = Math.max(0, (caffeineData[d]||0)+v); 
    localStorage.setItem('caffeine', JSON.stringify(caffeineData)); render(); 
}
function addAlcohol(v) { 
    const d = dp.value; alcoholData[d] = Math.max(0, (alcoholData[d]||0)+v); 
    localStorage.setItem('alcohol', JSON.stringify(alcoholData)); render(); 
}
function updateConsumptionUI() {
    const d = dp.value;
    const c = caffeineData[d] || 0; const a = alcoholData[d] || 0;
    document.getElementById('caffeineCount').innerText = c;
    document.getElementById('caffeineStatus').innerText = `${c} cups today`;
    document.getElementById('alcoholCount').innerText = a;
    document.getElementById('alcoholStatus').innerText = `${a} units today`;
    renderGraph();
}

/* HABITS & GARDEN (Stripped for brevity, same as previous) */
function getHash(s) { let h=0; for(let i=0;i<s.length;i++) h=((h<<5)-h)+s.charCodeAt(i); return Math.abs(h); }
function render() { 
    const h = JSON.parse(localStorage.getItem('habits') || '[]'), d = dp.value; 
    const hl = document.getElementById('habitList'); const g = document.getElementById('garden');
    hl.innerHTML = ''; g.innerHTML = ''; 
    h.forEach((x, i) => { 
        let s = 0, curr = new Date(d + "T12:00:00"); 
        while(x.done.includes(curr.toISOString().slice(0,10))) { s++; curr.setDate(curr.getDate()-1); } 
        hl.innerHTML += `<div class="habit"><div style="flex:1"><strong>${x.name}</strong><br><small>Streak: ${s}d</small></div><div class="check ${x.done.includes(d)?'done':''}" onclick="toggleHabit(${i})">${x.done.includes(d)?'‚úì':''}</div></div>`; 
        if (x.done.includes(d)) {
            const hash = getHash(x.name);
            g.innerHTML += `<div class="plant" style="font-size:2rem; margin-left:${(hash%10)-5}px">üå±</div>`;
        }
    }); 
    updateConsumptionUI(); renderCalendar(); 
} 
function toggleHabit(idx) { 
    const h = JSON.parse(localStorage.getItem('habits')||'[]'), d = dp.value; 
    const i = h[idx].done.indexOf(d); i>=0 ? h[idx].done.splice(i,1) : h[idx].done.push(d); 
    localStorage.setItem('habits', JSON.stringify(h)); render(); 
}
function addHabit() { 
    const i = document.getElementById('habitInput'); if(!i.value) return;
    const h = JSON.parse(localStorage.getItem('habits')||'[]'); h.push({name:i.value, done:[]});
    localStorage.setItem('habits', JSON.stringify(h)); i.value=''; render();
}

/* CALENDAR */
function renderCalendar() {
    const cal = document.getElementById('calendar'); const d = new Date(dp.value + "T12:00:00");
    const m = d.getMonth(), y = d.getFullYear(); cal.innerHTML = '';
    document.getElementById('monthLabel').innerText = d.toLocaleString('default', {month:'long', year:'numeric'});
    const first = new Date(y, m, 1).getDay(); const total = new Date(y, m+1, 0).getDate();
    for (let i=0; i<first; i++) cal.innerHTML += '<div></div>';
    for (let day=1; day<=total; day++) {
        const dStr = `${y}-${String(m+1).padStart(2,'0')}-${String(day).padStart(2,'0')}`;
        const el = document.createElement('div'); el.className = `cal-day ${dStr===dp.value?'active':''}`; el.innerText = day;
        el.onclick = () => { dp.value = dStr; render(); }; cal.appendChild(el);
    }
}

/* AUDIO */
function playTrack(t, el) { 
    const p = document.getElementById('naturePlayer'); const tracks = {storm:'storm.mp3', waves:'waves.mp3', forest:'forest.mp3', birds:'birdsong.mp3'};
    document.querySelectorAll('.track-card').forEach(c => c.classList.remove('playing')); el.classList.add('playing');
    p.src = "https://raw.githubusercontent.com/CourseDesignUK/HabitTracker/main/" + tracks[t]; p.play();
}
function stopAudio() { const p = document.getElementById('naturePlayer'); p.pause(); p.src = ""; }

/* BREATHING */
let bT, isB = false; function toggleBreathing() {
    isB = !isB; const c = document.getElementById('circle'), co = document.getElementById('count'), l = document.getElementById('label');
    if(!isB) { clearInterval(bT); co.innerText = '...'; l.innerText = 'TAP TO BREATHE'; c.style.transform = 'scale(1)'; return; }
    let step = 0, sec = 4;
    bT = setInterval(() => {
        co.innerText = sec; if(sec === 1) { step=(step+1)%4; sec=5; } sec--;
        const phases = ['INHALE', 'HOLD', 'EXHALE', 'HOLD']; l.innerText = phases[step];
        c.style.transform = (step===0||step===1) ? 'scale(1.2)' : 'scale(0.9)';
    }, 1000);
}

/* NAV */
const container = document.getElementById('screen-container'); let startX = 0;
window.addEventListener('touchstart', e => { startX = e.touches[0].clientX; container.style.transition = 'none'; });
window.addEventListener('touchmove', e => { 
    const diff = (e.touches[0].clientX - startX) / window.innerWidth * 25;
    container.style.transform = `translateX(${currentPane * -25 + diff}%)`;
});
window.addEventListener('touchend', e => {
    const diff = e.changedTouches[0].clientX - startX;
    if (Math.abs(diff) > 50) { if(diff<0 && currentPane<3) currentPane++; else if(diff>0 && currentPane>0) currentPane--; }
    container.style.transition = 'transform 0.5s cubic-bezier(0.16, 1, 0.3, 1)';
    container.style.transform = `translateX(${currentPane * -25}%)`;
    document.querySelectorAll('.dot').forEach((d, i) => d.classList.toggle('active', i === currentPane));
});

/* INIT */
dp.onchange = render; render();
</script> 
</body> 
</html>
